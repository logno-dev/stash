# Development Dockerfile with hot reloading
FROM node:20-alpine

WORKDIR /app

# Install nodemon for backend hot reloading
RUN npm install -g nodemon concurrently

# Copy package files for both frontend and backend
COPY backend/package*.json ./backend/
COPY frontend-react/package*.json ./frontend-react/

# Install dependencies
WORKDIR /app/backend
RUN npm install

WORKDIR /app/frontend-react
RUN npm install

# Copy source code
WORKDIR /app
COPY backend/ ./backend/
COPY frontend-react/ ./frontend-react/

# Create data directory
RUN mkdir -p data

# Expose ports
EXPOSE 3000 5173

# Development startup script
WORKDIR /app
CMD ["sh", "-c", "concurrently \"cd backend && nodemon server.js\" \"cd frontend-react && npm run dev -- --host 0.0.0.0\""]